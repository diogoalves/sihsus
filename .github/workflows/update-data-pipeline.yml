# This is a basic workflow to help you get started with Actions

name: update-data-pipeline

on:
  workflow_dispatch:
  schedule:
    - cron: '0 7 * * *' 

jobs:
  scheduled:
    runs-on: ubuntu-latest

    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      
      - name: Check out repository code
        uses: actions/checkout@v2.3.4
        with:
          submodules: 'true'
      
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."

      - name: Setup Python
        uses: actions/setup-python@v2.2.2
        
      - name: Pip Installer
        uses: BSFishy/pip-action@v1
        with:
          requirements: requirements.txt
          
      - name: Install lftp
        run: sudo apt install lftp -y
        
      - name: Start data pipeline
        run: make
        
      - name: List files in the repository
        run: |
          find ${{ github.workspace }}
          echo "🍏 This job's status is ${{ job.status }}."

   
        
      - name: Add & Commit
        uses: EndBug/add-and-commit@v7.2.1
        with:
          add: datasus.gov.br
